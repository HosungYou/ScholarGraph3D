# ScholarGraph3D v0.5.1 Release Notes

**Release Date:** February 20, 2026

---

## ğŸ› Bug Fix Release

v0.5.1 is a targeted patch release fixing three critical visualization and interaction bugs discovered in production after the v0.5.0 deployment. All features added in v0.5.0 remain intact.

---

## ğŸ“‹ Table of Contents

1. [Bug Fix: Expand Citations](#bug-fix-expand-citations)
2. [Bug Fix: Conceptual Edges SSE](#bug-fix-conceptual-edges-sse)
3. [Enhancement: Graph Relationships Panel](#enhancement-graph-relationships-panel)
4. [Files Changed](#files-changed)
5. [í•œêµ­ì–´ ìš”ì•½](#í•œêµ­ì–´-ìš”ì•½)

---

## Bug Fix: Expand Citations

### Root Cause

The expand citations feature (button click and double-click on a node) was silently failing because the wrong identifier was passed to the Semantic Scholar API.

**Problem:**
- The graph assigns each paper a **positional index** as its in-graph `id` (e.g., `"0"`, `"1"`, ..., `"199"`)
- `handleExpandPaper` called `api.expandPaper(paper.id)` â†’ URL: `/api/papers/0/expand`
- The backend passed this `"0"` directly to the S2 API: `GET https://api.semanticscholar.org/graph/v1/paper/0/references` â†’ 404

**Secondary issue:** `api.expandPaper` returns `ExpandResponse { references: [...], citations: [...] }` but the frontend read `.nodes` and `.edges` (both `undefined`), so `addNodes(undefined, undefined)` was silently called.

**Fix (both click and double-click handlers):**
- Use `paper.s2_paper_id` as the expand identifier instead of `paper.id`
- Switch from `expandPaper` to `expandPaperStable` which returns the correct `{ nodes, edges }` format
- Guard: if `paper.s2_paper_id` is missing, show a clear error toast ("Cannot expand: this paper has no Semantic Scholar ID") instead of silently failing

**Files:** `frontend/app/explore/page.tsx`

---

## Bug Fix: Conceptual Edges SSE

### Root Cause

The AI-powered conceptual edge analysis (Phase 4) was producing zero edges in production, silently emitting "Not enough papers found in database."

**Problem:**
- Frontend sent positional graph indices `["0", "1", ..., "199"]` as `paper_ids` to the SSE endpoint
- Backend query: `SELECT id, title, abstract, embedding FROM papers WHERE id = ANY($1)`
- The `papers` table uses **UUIDs** as primary key â€” matching UUIDs against `"0"`, `"1"`, etc. always returns 0 rows
- The stream immediately emitted the error event and closed

**Fix (frontend):**
1. Build a `Map<s2_paper_id, graph_node_id>` from all graph nodes that have `s2_paper_id`
2. Send the `s2_paper_id` values to the SSE endpoint instead of positional indices
3. In the `onEdge` callback, translate `edge.source` / `edge.target` (s2_paper_ids) back to graph node IDs using the map before storing in the Zustand `conceptualEdges` slice â€” this ensures ScholarGraph3D can correctly render the 3D edges between the right nodes

**Fix (backend):**
```sql
-- Before (broken)
SELECT id, title, abstract, embedding
FROM papers WHERE id = ANY($1)

-- After (fixed)
SELECT id, s2_paper_id, title, abstract, embedding
FROM papers WHERE s2_paper_id = ANY($1) AND s2_paper_id IS NOT NULL
```
- `papers_data` dict is now keyed by `s2_paper_id` (consistent with what `ids` contains)
- All downstream logic (valid_ids, embeddings, similarity pairs, edge emission) continues to use the same key format

**Files:** `frontend/app/explore/page.tsx`, `backend/routers/analysis.py`

---

## Enhancement: Graph Relationships Panel

### What Changed

The **GRAPH RELATIONSHIPS** section in `PaperDetailPanel` previously showed only three counters:
- Cited by (in graph): citation edges targeting this paper
- Cited in graph: citation edges from this paper
- Similar papers: similarity edges (cosine > 0.7) from initial search

These are stored in `graphData.edges`. **Conceptual edges** (AI-analyzed semantic relationships from the Phase 4 SSE stream) are stored separately in `conceptualEdges` in the Zustand store and were invisible in the panel.

**New fourth counter added:**
- **AI relationships: N analyzed** â€” counts conceptual edges from the `conceptualEdges` slice where `source === paper.id || target === paper.id`
- Displayed with a `Cpu` icon, matching the visual style of the existing three counters
- Once the SSE stream completes after each search, this counter populates automatically

**Files:** `frontend/components/graph/PaperDetailPanel.tsx`

---

## Files Changed

| File | Type | Change |
|------|------|--------|
| `frontend/app/explore/page.tsx` | Frontend | Fix expand ID (s2_paper_id), fix conceptual edges ID mapping |
| `frontend/components/graph/PaperDetailPanel.tsx` | Frontend | Add AI relationships counter |
| `backend/routers/analysis.py` | Backend | Fix DB query to use s2_paper_id |

**Commit:** `f83d456` â€” _fix: expand citations + conceptual edges + relationship panel_

---

## í•œêµ­ì–´ ìš”ì•½

### ìˆ˜ì •ëœ ë²„ê·¸ 3ê°œ

**1. ì¸ìš© ë…¼ë¬¸ í™•ì¥ (Expand Citations) ìˆ˜ì •**

ê·¸ë˜í”„ ë…¸ë“œì— í• ë‹¹ëœ ì„ì‹œ ì¸ë±ìŠ¤("0", "1", ...)ê°€ Semantic Scholar API í˜¸ì¶œì— ì‚¬ìš©ë˜ì–´ í•­ìƒ 404 ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì´ì œ `paper.s2_paper_id`ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •í•˜ì—¬ ì‹¤ì œ S2 ë…¼ë¬¸ IDë¡œ ë ˆí¼ëŸ°ìŠ¤/ì¸ìš© ë…¼ë¬¸ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. S2 IDê°€ ì—†ëŠ” ë…¼ë¬¸ì€ ëª…í™•í•œ ì˜¤ë¥˜ í† ìŠ¤íŠ¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.

**2. AI ê°œë… ì—£ì§€ SSE ìˆ˜ì •**

í”„ë¡ íŠ¸ì—”ë“œê°€ ì„ì‹œ ì¸ë±ìŠ¤ë¥¼ DB ì¡°íšŒìš© IDë¡œ ì „ì†¡í–ˆìœ¼ë‚˜ papers í…Œì´ë¸”ì€ UUIDë¥¼ ì‚¬ìš©í•´ í•­ìƒ 0ê°œ ê²°ê³¼ê°€ ë°˜í™˜ëìŠµë‹ˆë‹¤. ì´ì œ `s2_paper_id`ë¥¼ DB ì¡°íšŒ í‚¤ë¡œ ì‚¬ìš©í•˜ê³ , ë°˜í™˜ëœ ì—£ì§€ì˜ source/targetì„ ë‹¤ì‹œ ê·¸ë˜í”„ ë…¸ë“œ IDë¡œ ë³€í™˜í•©ë‹ˆë‹¤. ê²€ìƒ‰ í›„ ìë™ìœ¼ë¡œ AI ê´€ê³„ ë¶„ì„ì´ ë™ì‘í•©ë‹ˆë‹¤.

**3. ê´€ê³„ ì •ë³´ íŒ¨ë„ ê°œì„ **

ë…¼ë¬¸ ìƒì„¸ íŒ¨ë„ì˜ "GRAPH RELATIONSHIPS" ì„¹ì…˜ì— 4ë²ˆì§¸ í•­ëª©ì¸ "AI relationships: N analyzed"ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. ê¸°ì¡´ì—ëŠ” similarity/citation ì—£ì§€ë§Œ í‘œì‹œí•˜ì—¬ AI ë¶„ì„ ê²°ê³¼ê°€ ë³´ì´ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
