# ScholarGraph3D v0.5.0 Release Notes

**Release Date:** February 20, 2026

---

## ğŸ‰ What's New

ScholarGraph3D v0.5.0 introduces comprehensive **personalization and user profiling**, transforming the platform from a general research tool into a personalized knowledge companion. This release captures user interests, research behavior, and search patterns to deliver tailored paper recommendations, persistent research profiles, and a smarter home page that learns from your exploration.

---

## ğŸ“‹ Table of Contents

1. [OAuth Callback Fix](#oauth-callback-fix)
2. [Personalization Database Schema](#personalization-database-schema)
3. [Personalization API](#personalization-api)
4. [Frontend Integration](#frontend-integration)
5. [Recommendation Engine](#recommendation-engine)
6. [Dashboard Enhancements](#dashboard-enhancements)
7. [Migration Notes](#migration-notes)
8. [Known Limitations](#known-limitations)
9. [í•œêµ­ì–´ ìš”ì•½](#í•œêµ­ì–´-ìš”ì•½)
10. [Next: v0.6.0 Roadmap](#next-v060-roadmap)

---

## OAuth Callback Fix

### A2: Auth State Listening with Timeout Fallback

**Problem:** The OAuth callback page was using a broken 1-second unconditional timer that didn't wait for actual authentication completion. This caused redirect errors and failed login attempts in some scenarios.

**Root Cause:** The timer was firing before Supabase had fully established the authenticated session, particularly when network conditions were poor or OAuth provider responses were delayed.

**Solution:**
- Replaced unconditional timer with `supabase.auth.onAuthStateChange()` listener that explicitly waits for `SIGNED_IN` or `TOKEN_REFRESHED` events
- Added a 5-second timeout fallback that manually calls `getSession()`:
  - If session exists: redirects to `/dashboard`
  - If no session: redirects to `/auth?error=oauth_failed` with error message
- Added null guard for environments where Supabase is not configured

**Impact:** OAuth flows now complete reliably, with proper error handling for failed authentication attempts.

**File:** `frontend/app/auth/callback/page.tsx`

---

## Personalization Database Schema

### Phase B: New Tables (v0.5.0)

A new migration file (`backend/database/002_personalization.sql`) introduces 4 core personalization tables with efficient indexes and auto-update triggers.

#### `user_profiles` Table

Stores user metadata and research interests.

**Columns:**
- `user_id` (UUID, PK) â€” Links to Supabase Auth
- `display_name` (TEXT) â€” User's chosen display name
- `avatar_url` (TEXT) â€” Profile picture URL (optional)
- `research_interests` (TEXT[]) â€” Tags describing research domains (e.g., `['machine learning', 'nlp', 'transformers']`)
- `preferred_fields` (TEXT[]) â€” OpenAlex fields the user favors (e.g., `['computer-science', 'biology']`)
- `interest_embedding` (vector(768)) â€” Mean embedding of viewed paper titles/abstracts; enables pgvector ANN search for recommendations
- `default_year_min`, `default_year_max` (INT) â€” Default publication year filter preferences
- `min_citations_default` (INT) â€” Minimum citation count threshold (default: 0)
- `result_count_default` (INT) â€” Preferred number of results per search (default: 50)
- `search_count`, `interaction_count`, `recommendation_dismissals` (INT) â€” Usage analytics
- `created_at`, `updated_at` (TIMESTAMP) â€” Audit trail

**Indexes:**
- Unique on `user_id`
- GiST index on `interest_embedding` for fast ANN queries

**Auto-Trigger:** `update_user_profiles_updated_at` â€” Sets `updated_at` to `now()` on any row update

---

#### `user_search_history` Table

Logs all search queries with metadata for analytics and recall.

**Columns:**
- `id` (UUID, PK)
- `user_id` (UUID, FK)
- `query` (TEXT) â€” Original search query
- `mode` (TEXT) â€” Search mode: 'field', 'seed_paper', 'research_question'
- `result_count` (INT) â€” How many papers returned
- `filters_used` (JSONB) â€” Full filter state at search time (year range, min citations, etc.)
- `created_at` (TIMESTAMP)

**Indexes:**
- Index on `(user_id, created_at DESC)` for efficient user timeline queries
- Index on `(user_id, query)` for duplicate-detection on upsert

**Purpose:** Power the "Continue Exploring" section on home page, analytics, and watch query suggestions.

---

#### `user_paper_interactions` Table

Logs 5 types of paper interactions: view, save_graph, expand_citations, chat_mention, lit_review.

**Columns:**
- `id` (UUID, PK)
- `user_id` (UUID, FK)
- `paper_id` (TEXT, FK) â€” OpenAlex paper ID
- `action` (TEXT) â€” One of: `view`, `save_graph`, `expand_citations`, `chat_mention`, `lit_review`
- `context` (JSONB) â€” Optional metadata (e.g., graph_id for save_graph, query for view)
- `created_at` (TIMESTAMP)

**Indexes:**
- Index on `(user_id, created_at DESC)` for user timeline
- Index on `(user_id, paper_id)` for interaction summaries

**Purpose:** Feed viewed paper embeddings into `user_profiles.interest_embedding` calculation; power "Recently Viewed" sections.

---

#### `user_recommendations` Table

Cached 24-hour recommendation results with soft-delete dismiss logic.

**Columns:**
- `id` (UUID, PK)
- `user_id` (UUID, FK)
- `paper_id` (TEXT, FK) â€” Recommended paper
- `score` (FLOAT) â€” pgvector similarity score (0â€“1 range)
- `explanation` (TEXT) â€” Groq-generated 1-sentence explanation (e.g., "This paper applies transformer architectures similar to your recent reads.")
- `reason_tags` (TEXT[]) â€” Why it was recommended (e.g., `['semantic_similarity', 'highly_cited']`)
- `is_dismissed` (BOOLEAN) â€” Soft-delete flag (default: false)
- `created_at` (TIMESTAMP) â€” When recommendation was generated
- `expires_at` (TIMESTAMP) â€” 24 hours after creation (recommendations auto-refresh daily)

**Indexes:**
- Index on `(user_id, is_dismissed, created_at DESC)` for efficient query of active recommendations
- Index on `expires_at` for periodic cleanup job

**Purpose:** Serve the "Recommended for You" section on dashboard with minimal latency.

---

## Personalization API

### Phase C: 6 New Endpoints

All endpoints are under `/api/user/` prefix and require Supabase authentication (JWT bearer token).

#### 1. `GET /api/user/profile`

Auto-creates user profile on first access.

**Response (200 OK):**
```json
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "display_name": "Dr. Jane Researcher",
  "avatar_url": "https://...",
  "research_interests": ["machine learning", "nlp", "transformers"],
  "preferred_fields": ["computer-science", "mathematics"],
  "default_year_min": 2015,
  "default_year_max": 2026,
  "min_citations_default": 5,
  "result_count_default": 50,
  "search_count": 42,
  "interaction_count": 127,
  "recommendation_dismissals": 3,
  "created_at": "2026-01-15T10:30:00Z",
  "updated_at": "2026-02-20T08:15:00Z"
}
```

**Behavior:** If profile doesn't exist, creates default with `display_name=""`, empty arrays, year range [1900â€“2026], min_citations=0, result_count=50.

---

#### 2. `PUT /api/user/profile`

Partial updateâ€”send only fields you want to change.

**Request Body:**
```json
{
  "display_name": "Jane Smith",
  "research_interests": ["machine learning", "bioinformatics"],
  "preferred_fields": ["computer-science", "biology"],
  "default_year_min": 2020,
  "min_citations_default": 10,
  "result_count_default": 100
}
```

**Response (200 OK):** Returns updated profile (same shape as GET).

**Note:** Sent from frontend; only called when user edits profile settings. Never blocks searchâ€”fire-and-forget.

---

#### 3. `POST /api/user/events`

Fire-and-forget logging of paper interactions.

**Request Body:**
```json
{
  "action": "view",
  "paper_id": "A1234567890",
  "context": {
    "query": "neural networks",
    "graph_id": "g_xyz123"
  }
}
```

**Accepted Actions:** `view`, `save_graph`, `expand_citations`, `chat_mention`, `lit_review`

**Response (202 Accepted):** Always returns 202; errors are logged server-side but never propagated to frontend (prevents UX disruption).

**Behavior:** Silently ignores database errors (connection timeouts, constraint violations). Logs exceptions at WARN level for debugging.

---

#### 4. `POST /api/user/search-history`

Logs search query with upsert counter increment for duplicate searches.

**Request Body:**
```json
{
  "query": "federated learning",
  "mode": "field",
  "result_count": 47,
  "filters_used": {
    "year_min": 2020,
    "year_max": 2026,
    "min_citations": 5
  }
}
```

**Response (200 OK):**
```json
{
  "search_id": "s_abc123",
  "duplicates_count": 3,
  "created_at": "2026-02-20T09:12:00Z"
}
```

**Upsert Logic:** If exact query (same text + mode) exists within 24h, increments counter instead of creating new row. Enables "search 3 times in the last week" analytics.

---

#### 5. `GET /api/user/recommendations`

Retrieves top-10 personalized recommendations using pgvector ANN search + Groq explanation.

**Response (200 OK):**
```json
{
  "recommendations": [
    {
      "id": "rec_001",
      "paper_id": "A9876543210",
      "title": "Attention Is All You Need",
      "authors": ["Vaswani, A.", "..."],
      "year": 2017,
      "citation_count": 84562,
      "score": 0.87,
      "explanation": "This foundational transformer paper aligns with your interest in attention mechanisms and NLP.",
      "reason_tags": ["semantic_similarity", "highly_cited"],
      "tldr": "We propose a new network architecture...",
      "is_dismissed": false
    }
  ],
  "generated_at": "2026-02-20T08:00:00Z",
  "expires_at": "2026-02-21T08:00:00Z"
}
```

**Algorithm:**
1. Fetch all papers user has viewed (from `user_paper_interactions`)
2. Calculate mean embedding of their SPECTER2 vectors â†’ `user_interests_vector`
3. Run pgvector ANN search: `SELECT TOP 100 papers WHERE similarity(paper_embedding, user_interests_vector) > 0.7 AND is_dismissed=false`
4. For top 10, call Groq LLaMA-3.3-70b to generate 1-sentence explanations (batch request)
5. Attach reason_tags: "semantic_similarity" always; "highly_cited" if citation_count > field median
6. Cache result for 24h (expires_at = now + 24h)

**Performance:** ANN search on 768-dim vectors is O(log N) with pgvector ivfflat index; typical response <500ms.

**Graceful Degradation:** If Groq API is unavailable or GROQ_API_KEY not set, explanations default to "We recommend this based on papers you've viewed."

**Cache Refresh:** Recommendations automatically refresh after 24h expiry on next GET request.

---

#### 6. `DELETE /api/user/recommendations/{id}/dismiss`

Soft-deletes a recommendation (sets `is_dismissed=true`).

**Response (200 OK):**
```json
{
  "id": "rec_001",
  "is_dismissed": true,
  "message": "Recommendation dismissed"
}
```

**Frontend Behavior:** Optimistic removalâ€”UI hides card immediately; if DELETE fails silently, card reappears on next refresh.

---

## Frontend Integration

### Phase D: Types, API Methods, Components

#### Types (`frontend/types/index.ts`)

```typescript
interface UserProfile {
  user_id: string;
  display_name: string;
  avatar_url?: string;
  research_interests: string[];
  preferred_fields: string[];
  default_year_min: number;
  default_year_max: number;
  min_citations_default: number;
  result_count_default: number;
  search_count: number;
  interaction_count: number;
  recommendation_dismissals: number;
  created_at: string;
  updated_at: string;
}

interface Recommendation {
  id: string;
  paper_id: string;
  title: string;
  authors: string[];
  year: number;
  citation_count: number;
  score: number;
  explanation: string;
  reason_tags: string[];
  tldr?: string;
  is_dismissed: boolean;
}

interface InteractionEvent {
  action: 'view' | 'save_graph' | 'expand_citations' | 'chat_mention' | 'lit_review';
  paper_id: string;
  context?: Record<string, any>;
}
```

---

#### API Client Methods (`frontend/lib/api.ts`)

```typescript
export async function getUserProfile(): Promise<UserProfile> { ... }
export async function updateUserProfile(updates: Partial<UserProfile>): Promise<UserProfile> { ... }
export async function logInteraction(event: InteractionEvent): Promise<void> { ... }
export async function logSearch(query: string, mode: string, result_count: number, filters: any): Promise<void> { ... }
export async function getRecommendations(): Promise<Recommendation[]> { ... }
export async function dismissRecommendation(id: string): Promise<void> { ... }
```

**Fire-and-Forget Pattern:** All methods are fire-and-forget (Promise<void>) for logging callsâ€”never block UI or throw errors to user. Backend logs and discards on error.

---

#### Search Logging (`frontend/app/explore/page.tsx`)

**Before Search Results:**
```typescript
// After results arrive
logSearch(query, mode, results.nodes.length, filtersUsed);
```

**After Paper Select:**
```typescript
// In PaperDetailPanel
logInteraction({ action: 'view', paper_id: selectedPaper.id, context: { query } });
```

**After Citation Expand:**
```typescript
// In PaperDetailPanel expand handler
logInteraction({ action: 'expand_citations', paper_id: paper.id });
```

---

#### Recommendation Card Component (`frontend/components/dashboard/RecommendationCard.tsx`)

New component renders a single recommendation card:

```tsx
interface RecommendationCardProps {
  recommendation: Recommendation;
  onDismiss: (id: string) => void;
}

export function RecommendationCard({ recommendation, onDismiss }: RecommendationCardProps) {
  return (
    <div className="rounded-lg border border-slate-700 bg-slate-800 p-4 hover:border-slate-500">
      {/* Title (linked to paper detail) */}
      <h3 className="font-semibold text-white truncate">{recommendation.title}</h3>

      {/* Meta: Authors, Year, Citation Count */}
      <p className="text-sm text-slate-400 mt-1">
        {recommendation.authors.slice(0, 2).join(', ')} Â· {recommendation.year} Â· {recommendation.citation_count} citations
      </p>

      {/* TLDR or Explanation */}
      <p className="text-xs text-slate-300 mt-2 line-clamp-2">
        {recommendation.tldr || recommendation.explanation}
      </p>

      {/* Reason Tags */}
      <div className="flex gap-1 mt-2 flex-wrap">
        {recommendation.reason_tags.map(tag => (
          <span key={tag} className="text-xs bg-slate-700 px-2 py-1 rounded">
            {tag}
          </span>
        ))}
      </div>

      {/* Match Score + Actions */}
      <div className="flex justify-between items-center mt-3">
        <span className="text-xs text-purple-400 font-bold">
          {Math.round(recommendation.score * 100)}% match
        </span>
        <div className="flex gap-2">
          <button onClick={() => { /* navigate to paper */ }} className="text-xs text-blue-400">
            Explore â†’
          </button>
          <button onClick={() => onDismiss(recommendation.id)} className="text-xs text-slate-500">
            âœ•
          </button>
        </div>
      </div>
    </div>
  );
}
```

---

#### Dashboard Enhancements (`frontend/app/dashboard/page.tsx`)

Added "Recommended for You" section:

```tsx
export default function DashboardPage() {
  const [recommendations, setRecommendations] = useState<Recommendation[]>([]);
  const [isLoadingRecs, setIsLoadingRecs] = useState(true);

  useEffect(() => {
    const loadRecommendations = async () => {
      setIsLoadingRecs(true);
      try {
        const recs = await getRecommendations();
        setRecommendations(recs);
      } catch (err) {
        // Silently fail; show empty state
      } finally {
        setIsLoadingRecs(false);
      }
    };

    loadRecommendations();
  }, []);

  const handleDismiss = async (id: string) => {
    // Optimistic removal
    setRecommendations(prev => prev.filter(r => r.id !== id));
    await dismissRecommendation(id); // Fire-and-forget
  };

  return (
    <div className="space-y-8">
      {/* Existing Watch Queries section */}

      {/* Recommended for You (NEW) */}
      {(isLoadingRecs || recommendations.length > 0) && (
        <section>
          <h2 className="text-xl font-semibold text-white mb-4">Recommended for You</h2>
          {isLoadingRecs ? (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {Array(3).fill(0).map((_, i) => (
                <div key={i} className="animate-pulse bg-slate-700 h-32 rounded-lg" />
              ))}
            </div>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {recommendations.map(rec => (
                <RecommendationCard
                  key={rec.id}
                  recommendation={rec}
                  onDismiss={handleDismiss}
                />
              ))}
            </div>
          )}
        </section>
      )}
    </div>
  );
}
```

---

#### Home Page Updates (`frontend/app/page.tsx`)

Added "Continue Exploring" section for logged-in users:

```tsx
export default function HomePage() {
  const { user } = useAuth();
  const [recentSearches, setRecentSearches] = useState<string[]>([]);
  const [researchInterests, setResearchInterests] = useState<string[]>([]);
  const [stats, setStats] = useState({ searches: 0, interactions: 0 });

  useEffect(() => {
    if (!user) return;

    const loadUserContext = async () => {
      const profile = await getUserProfile();
      setResearchInterests(profile.research_interests);
      setStats({ searches: profile.search_count, interactions: profile.interaction_count });
      // recentSearches from localStorage or via API call
    };

    loadUserContext();
  }, [user]);

  if (!user) {
    // Show existing landing page for non-authenticated users
    return <LandingPage />;
  }

  return (
    <div className="min-h-screen bg-gradient-to-b from-slate-900 via-slate-800 to-slate-900 p-8">
      {/* Header: "Welcome back, [name]" */}

      {/* Continue Exploring Section */}
      <section className="mt-8">
        <h2 className="text-2xl font-bold text-white mb-4">Continue Exploring</h2>

        {/* Research Interest Pills (purple) */}
        {researchInterests.length > 0 && (
          <div className="mb-4">
            <p className="text-slate-400 text-sm mb-2">Your Research Interests</p>
            <div className="flex flex-wrap gap-2">
              {researchInterests.map(interest => (
                <button
                  key={interest}
                  onClick={() => navigateToExplore(interest, 'field')}
                  className="px-4 py-2 rounded-full bg-purple-600 hover:bg-purple-500 text-white text-sm"
                >
                  {interest}
                </button>
              ))}
            </div>
          </div>
        )}

        {/* Recent Searches Pills (slate) */}
        {recentSearches.length > 0 && (
          <div className="mb-4">
            <p className="text-slate-400 text-sm mb-2">Recent Searches</p>
            <div className="flex flex-wrap gap-2">
              {recentSearches.map(search => (
                <button
                  key={search}
                  onClick={() => navigateToExplore(search, 'field')}
                  className="px-4 py-2 rounded-full bg-slate-700 hover:bg-slate-600 text-white text-sm"
                >
                  {search}
                </button>
              ))}
            </div>
          </div>
        )}

        {/* Stats Footer */}
        <div className="mt-6 flex gap-8 text-slate-400 text-sm">
          <div>
            <span className="font-semibold text-white">{stats.searches}</span> searches
          </div>
          <div>
            <span className="font-semibold text-white">{stats.interactions}</span> papers explored
          </div>
          <button className="text-blue-400 hover:text-blue-300">
            Go to Dashboard â†’
          </button>
        </div>
      </section>
    </div>
  );
}
```

---

## Recommendation Engine

### Algorithm Deep Dive

The recommendation engine runs on a 24-hour refresh cycle and uses pgvector ANN search combined with LLM-generated explanations.

**Step 1: User Interest Vector Calculation**
```sql
-- Compute mean embedding from viewed papers
SELECT AVG(embedding)::vector(768) as user_interests_embedding
FROM papers
WHERE paper_id IN (
  SELECT DISTINCT paper_id
  FROM user_paper_interactions
  WHERE user_id = $1 AND action = 'view'
);
```

**Step 2: pgvector ANN Search (Top 100)**
```sql
SELECT paper_id, title, authors, year, citation_count,
       (embedding <-> $1::vector)::float as distance
FROM papers
WHERE (embedding <-> $1::vector) < 0.3 -- cosine distance < 0.3 â‰ˆ similarity > 0.85
  AND paper_id NOT IN (SELECT paper_id FROM user_paper_interactions WHERE user_id = $2)
ORDER BY distance ASC
LIMIT 100;
```

**Step 3: Groq Batch Explanation Generation**
```python
groq_client.chat.completions.create(
  model="llama-3.3-70b-versatile",
  messages=[
    {"role": "system", "content": "Generate a 1-sentence explanation of why this paper would interest a researcher..."},
    {"role": "user", "content": f"Paper: {title}. User interests: {user_interests}. Explain why:"}
  ],
  max_tokens=100,
  temperature=0.3
)
```

**Step 4: Score Calculation & Filtering**
- Primary score = 1 - cosine_distance (range 0â€“1)
- Boost for high citations: if citation_count > field_median, append "highly_cited" tag
- Filter out dismissed recommendations
- Sort by primary score descending, take top 10

**Step 5: Cache & Expire**
- Store in `user_recommendations` with 24h TTL
- On next GET, check if `expires_at > now()`; if expired, recalculate

---

## Dashboard Enhancements

### "Recommended for You" Section

**Placement:** Below Watch Queries section on `/dashboard`

**Visibility:**
- Only shown if user has viewed at least 1 paper with an embedding
- Shows loading skeleton if generating first time
- Hidden entirely if user has 0 recommendations (graceful degradation)

**Interaction:**
- Click "Explore" â†’ navigates to `/explore?seed_paper={paper_id}`
- Click "âœ•" â†’ soft-dismiss + optimistic UI removal
- Recommendations refresh automatically every 24h or on manual refresh

**Mobile Responsive:** Grid adapts to 1-col (mobile), 2-col (tablet), 3-col (desktop).

---

### Home Page "Continue Exploring"

**Placement:** New section for authenticated users only

**Content:**
- Research interest pills (purple, clickable)
- Recent search pills (slate, clickable)
- Stats footer (search count, interaction count, dashboard link)

**Behavior:**
- Research interests come from user profile
- Recent searches loaded from localStorage or `user_search_history` API
- Clicking pill navigates to `/explore?query={query}&mode=field`

---

## Migration Notes

### Database Migration

Run the personalization schema migration on your Supabase database:

```bash
# In Supabase SQL Editor, run:
psql postgresql://user:password@db.supabase.co/postgres < backend/database/002_personalization.sql

# Or manually copy-paste the SQL into the Supabase SQL Editor
```

**Migration includes:**
- 4 new tables: `user_profiles`, `user_search_history`, `user_paper_interactions`, `user_recommendations`
- Indexes on `(user_id, ...)` for efficient queries
- GiST index on `interest_embedding` for pgvector ANN
- Auto-update trigger on `user_profiles.updated_at`

**No breaking changes:** All existing tables and endpoints remain functional. Personalization is purely additive.

---

### Supabase OAuth Configuration

Ensure OAuth providers are enabled:

1. Go to Supabase Dashboard â†’ Authentication â†’ Providers
2. Enable **Google** and **GitHub** (if using OAuth)
3. Add redirect URLs to **Auth â†’ URL Configuration**:
   ```
   Redirect URLs:
   - http://localhost:3000/auth/callback
   - https://yourdomain.com/auth/callback
   ```

---

### Environment Variables

No new required environment variables for v0.5.0:

- `GROQ_API_KEY` (optional) â€” Enables Groq explanations for recommendations; if not set, defaults to static text
- All other vars remain as in v0.4.0

---

### Updating Your Installation

```bash
# Pull latest changes
git pull origin main

# Install dependencies (if any new packages)
npm install

# Backend: ensure migration runs (automatic on app startup if using Alembic)
cd backend
pip install -r requirements.txt

# Restart dev server
npm run dev      # Frontend
# In another terminal:
uvicorn main:app --reload --port 8000  # Backend
```

---

## Known Limitations

### Recommendation Accuracy

- Recommendations require at least 1 viewed paper with an embedding in the database
- If user has viewed few papers (<5), recommendations may show lower diversity
- SPECTER2 embeddings are trained on citation networks; may not capture domain-specific nuances

**Workaround:** Users with few interactions will see recommendations improve over time as they explore more papers.

---

### Groq API Fallback

- Groq explanations are optional; if `GROQ_API_KEY` is not set or API is unavailable, explanations default to generic text
- Batch explanation generation for 10 papers takes 2â€“5 seconds

**Workaround:** Set `GROQ_API_KEY` in `.env` to enable AI-powered explanations.

---

### Canvas Click Logging

- Node-click interactions in the 3D graph (ScholarGraph3D canvas) do not yet log `view` events
- Workaround: Click the paper title in the detail panel to trigger logging

**Note:** This will be fixed in v0.6.0 when canvas click state is wired to personalization service.

---

### Large User Profiles

- If a user has viewed 500+ papers, interest_embedding calculation may take 2â€“5 seconds
- Recommendations for power users may show higher latency on first request of the day

**Workaround:** Recommendations are cached for 24h; subsequent GETs are <100ms.

---

### Search History Growth

- `user_search_history` grows unbounded; no automatic cleanup yet
- Recommend periodic cleanup job (e.g., delete rows >1 year old) in production

---

## í•œêµ­ì–´ ìš”ì•½

### ScholarGraph3D v0.5.0 ì—…ë°ì´íŠ¸ ë‚´ìš©

#### OAuth ì½œë°± ìˆ˜ì • (Phase A2)
- **ë¬¸ì œ:** 1ì´ˆ ë¬´ì¡°ê±´ íƒ€ì´ë¨¸ê°€ Supabase ì¸ì¦ ì™„ë£Œ ì „ì— ì‹¤í–‰ë˜ì–´ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹¤íŒ¨
- **í•´ê²°ì±…:** `supabase.auth.onAuthStateChange()` ë¦¬ìŠ¤ë„ˆë¡œ `SIGNED_IN` / `TOKEN_REFRESHED` ì´ë²¤íŠ¸ ëŒ€ê¸°
- **í´ë°±:** 5ì´ˆ í›„ ìˆ˜ë™ `getSession()` í˜¸ì¶œ â†’ ì„¸ì…˜ ìˆìœ¼ë©´ `/dashboard`, ì—†ìœ¼ë©´ `/auth?error=oauth_failed` ë¦¬ë‹¤ì´ë ‰íŠ¸

#### ê°œì¸í™” DB ìŠ¤í‚¤ë§ˆ (Phase B)
4ê°œ ì‹ ê·œ í…Œì´ë¸” (`backend/database/002_personalization.sql`):
- **`user_profiles`** â€” ì‚¬ìš©ì ì´ë¦„, ì•„ë°”íƒ€, ì—°êµ¬ ê´€ì‹¬ì‚¬(TEXT[]), ì„ í˜¸ í•„ë“œ, interest_embedding (vector(768)), ê¸°ë³¸ í•„í„° ì„¤ì •, ì‚¬ìš© í†µê³„
  - Auto-trigger: `updated_at` ìë™ ê°±ì‹ 
- **`user_search_history`** â€” ëª¨ë“  ê²€ìƒ‰ ì¿¼ë¦¬ ë¡œê¹… (query, mode, result_count, filters_used JSONB)
  - Upsert ê¸°ëŠ¥: 24ì‹œê°„ ë‚´ ì¤‘ë³µ ê²€ìƒ‰ ì‹œ ì¹´ìš´í„° ì¦ê°€
- **`user_paper_interactions`** â€” 5ê°€ì§€ ì•¡ì…˜: view, save_graph, expand_citations, chat_mention, lit_review
  - SPECTER2 embedding í”¼ë“œë¡œ interest_embedding ê³„ì‚°ì— ì‚¬ìš©
- **`user_recommendations`** â€” 24ì‹œê°„ ìºì‹œ ì¶”ì²œ ê²°ê³¼ (score, Groq ì„¤ëª…, reason_tags, soft-delete)
  - GiST ì¸ë±ìŠ¤: pgvector ANN ê²€ìƒ‰ ê³ ì†í™”

#### ê°œì¸í™” API (Phase C)
6ê°œ ì‹ ê·œ ì—”ë“œí¬ì¸íŠ¸ (`backend/routers/personalization.py`):
1. **`GET /api/user/profile`** â€” ì²« ì ‘ê·¼ ì‹œ ìë™ ìƒì„±
2. **`PUT /api/user/profile`** â€” ë¶€ë¶„ ì—…ë°ì´íŠ¸
3. **`POST /api/user/events`** â€” ë…¼ë¬¸ ìƒí˜¸ì‘ìš© ë¡œê¹… (fire-and-forget, ì—ëŸ¬ ë¬´ì‹œ)
4. **`POST /api/user/search-history`** â€” ê²€ìƒ‰ ê¸°ë¡ ë° ì¤‘ë³µ ì¹´ìš´íŒ…
5. **`GET /api/user/recommendations`** â€” pgvector ANN ê²€ìƒ‰ + Groq ì„¤ëª… (top 10, 24ì‹œê°„ ìºì‹œ)
   - ì•Œê³ ë¦¬ì¦˜: ì‚¬ìš©ì ì—´ëŒ ë…¼ë¬¸ embedding í‰ê·  â†’ ANN ê²€ìƒ‰ â†’ Groq ì¼ë¬¸ì¥ ì„¤ëª… ìƒì„±
6. **`DELETE /api/user/recommendations/{id}/dismiss`** â€” Soft-delete

#### í”„ë¡ íŠ¸ì—”ë“œ í†µí•© (Phase D)
- **íƒ€ì…:** `UserProfile`, `Recommendation`, `InteractionEvent` ì¶”ê°€ (`frontend/types/index.ts`)
- **API ë©”ì„œë“œ:** `getUserProfile`, `updateUserProfile`, `logInteraction`, `logSearch`, `getRecommendations`, `dismissRecommendation` (`frontend/lib/api.ts`)
  - ëª¨ë“  ë¡œê¹… ë©”ì„œë“œëŠ” fire-and-forget (UX ë°©í•´ ì•ˆ í•¨)
- **ì»´í¬ë„ŒíŠ¸:** `RecommendationCard.tsx` (ì‹ ê·œ) â€” ì¶”ì²œ ì¹´ë“œ (ì œëª©, ì €ì/ì—°ë„/ì¸ìš©ìˆ˜, TLDR, ì´ìœ  íƒœê·¸, ë§¤ì¹­ ì ìˆ˜, ë¬´ì‹œ ë²„íŠ¼)
- **ëŒ€ì‹œë³´ë“œ:** "Recommended for You" ì„¹ì…˜ ì¶”ê°€ (3ì—´ ê·¸ë¦¬ë“œ, ìµœì†Œ 1ê°œ ì—´ëŒ ë…¼ë¬¸ í•„ìš”)
- **í™ˆí˜ì´ì§€:** ë¡œê·¸ì¸ ì‚¬ìš©ììš© "Continue Exploring" ì„¹ì…˜ (ì—°êµ¬ ê´€ì‹¬ì‚¬ ì•½ê°„, ìµœê·¼ ê²€ìƒ‰ ì•½ê°„, í†µê³„ í‘¸í„°)

#### ì¶”ì²œ ì—”ì§„ ì•Œê³ ë¦¬ì¦˜
1. ì‚¬ìš©ìê°€ ì—´ëŒí•œ ë…¼ë¬¸ì˜ SPECTER2 embedding í‰ê·  ê³„ì‚°
2. pgvector ANN ê²€ìƒ‰: `embedding <-> user_interest_vector` ê±°ë¦¬ < 0.3 (ìƒìœ„ 100ê°œ)
3. ìƒìœ„ 10ê°œì— ëŒ€í•´ Groq LLaMA-3.3-70bë¡œ 1ë¬¸ì¥ ì„¤ëª… ìƒì„± (ë°°ì¹˜ ìš”ì²­)
4. reason_tags: "semantic_similarity" í•­ìƒ; "highly_cited" (ì¸ìš©ìˆ˜ > ë¶„ì•¼ ì¤‘ìœ„ê°’)
5. 24ì‹œê°„ ìºì‹œ (expires_at ì‹œê°„ ê²½ê³¼ í›„ ìë™ ê°±ì‹ )

#### ë§ˆì´ê·¸ë ˆì´ì…˜ ë…¸íŠ¸
- `backend/database/002_personalization.sql` ì‹¤í–‰ (Supabase SQL ì—ë””í„°)
- ê¸°ì¡´ ì—”ë“œí¬ì¸íŠ¸ ëª¨ë‘ ì •ìƒ ì‘ë™ (í•˜ìœ„ í˜¸í™˜ì„± ì™„ë²½ ìœ ì§€)
- `.env.local`ì— `GROQ_API_KEY` ì„¤ì • (ì„ íƒì‚¬í•­, ì„¤ì • ì—†ìœ¼ë©´ ê¸°ë³¸ ì„¤ëª… ì‚¬ìš©)

---

## Next: v0.6.0 Roadmap

### Planned Features

**Advanced Filter Preferences**
- Save filter preferences to user profile (year range, min citations, etc.)
- Auto-apply saved filters on next search
- Filter preset templates (e.g., "High Impact", "Recent Breakthroughs", "Emerging")

**GitHub OAuth Integration**
- Add GitHub as authentication provider
- Display GitHub profile alongside research identity
- Link to GitHub research repositories

**Email Digests for Watched Queries**
- Personalized weekly/monthly email summaries of watched query updates
- Use personalization data (research interests, preferred fields) to prioritize new papers
- Groq-powered email generation with summaries and relevance scores

**Mobile-Responsive Recommendation Cards**
- Optimize recommendation cards for small screens
- Touch-friendly dismiss button and Explore navigation
- Swipe gestures for carousel-style browsing (optional)

**Collaborative Research Spaces**
- Share research graphs with team members
- Multi-user annotations and comments on papers
- Collaborative note-taking within graph
- Role-based access: Viewer, Annotator, Owner

**Paper Embedding Refresh Strategy**
- Periodic background jobs to refresh SPECTER2 embeddings for new papers
- Trigger manual embedding recalculation for user interest vectors
- Monitor embedding quality metrics

**Recommendation Explanation Improvement**
- Fine-tune Groq prompts for more actionable explanations
- Include "related papers" context in explanations
- A/B testing on explanation quality with user feedback surveys

### Community Feedback

We're actively seeking community input on v0.6.0 priorities. Please open GitHub issues to vote on features you'd like to see next!

---

## Questions or Feedback?

- **GitHub Issues:** Report bugs or request features on our [GitHub repository](https://github.com/yourusername/scholargraph3d)
- **Documentation:** Check out our [comprehensive docs](https://docs.scholargraph3d.example.com)
- **Community:** Join our Discord server for discussions and updates

---

**Happy researching! ğŸš€**
