# ScholarGraph3D v0.5.2 Release Notes

**Release Date:** February 20, 2026

---

## ğŸ› Critical Bug Fix + Improvements

v0.5.2 fixes a critical embedding coverage regression causing only ~5% of papers to receive SPECTER2 embeddings in the 3D graph, plus several expand-citation and UX improvements.

---

## ğŸ“‹ Table of Contents

1. [Critical Fix: Embedding Coverage](#critical-fix-embedding-coverage)
2. [Expand Citations: Smarter Positioning + Edges](#expand-citations-smarter-positioning--edges)
3. [RAG Chat: Richer Context](#rag-chat-richer-context)
4. [Minor Improvements](#minor-improvements)
5. [Files Changed](#files-changed)
6. [í•œêµ­ì–´ ìš”ì•½](#í•œêµ­ì–´-ìš”ì•½)

---

## Critical Fix: Embedding Coverage

### Root Cause

**Before:** Only ~5% of graph papers (e.g., 10/200) had SPECTER2 embeddings â†’ sparse similarity edges, poor HDBSCAN clustering, flat blob visualization.

**After:** ~50% of graph papers have SPECTER2 embeddings (e.g., 97/200) â†’ rich similarity edges, proper multi-cluster topology.

### The Bug

`DataFusionService._merge_results()` processes papers in this order:
1. **200 OA papers first** (main metadata, no SPECTER2 embeddings by default)
2. **S2-only papers appended** (have SPECTER2 embeddings from S2 API)

After merging 290 total papers (97 with embeddings), the code truncated with `merged[:200]` â€” returning the first 200 OA papers. Since only 10 OA papers happened to match S2 papers via DOI/title (getting their embeddings), the other 87 S2-only embedding papers at positions 200â€“289 were silently discarded.

The fix existed locally (as an uncommitted change) but was never pushed to the repository, so the Render deployment never had it.

### Fix

Added a sort before truncation in `data_fusion.py`:

```python
# Prioritize papers with embeddings to avoid losing them during truncation
merged.sort(key=lambda p: (p.embedding is None,))

# Return unified paper list (up to limit)
return merged[:limit]
```

`(p.embedding is None,)` evaluates to `(False,)` for papers with embeddings and `(True,)` for those without. Python's stable ascending sort puts `False` (0) before `True` (1), so all embedding papers rise to the top before truncation.

**Result:** 97 embedding papers are in the first 200 â†’ UMAP runs on 97 points â†’ proper 3D topology with 3+ clusters instead of a single blob.

**File:** `backend/integrations/data_fusion.py`

---

## Expand Citations: Smarter Positioning + Edges

### Embedding-Aware Spatial Placement

Previously, `expand_paper_stable` fetched references/citations **without** SPECTER2 embeddings and placed all expanded nodes at random `gauss(0, 10)` positions. This caused expanded papers to appear in a random cluster far from their semantic neighbors.

**Fix:**
- Fetch refs/citations with `include_embedding=True`
- Use `place_new_paper(embedding, existing_nodes)` â€” k-NN weighted average of existing node positions â€” for embedding-aware 3D placement
- Use `assign_cluster(embedding, cluster_centroids)` â€” cosine distance to cluster centroids â€” to assign the correct cluster
- Fallback to random placement if no embedding available

### Citation Edges Now Returned

Previously, `expand_paper_stable` returned `edges=[]` â€” no edges were added when expanding. This meant expanded nodes floated disconnected from the graph.

**Fix:** Builds explicit citation edges between the expanded paper and all returned refs/citations:
```python
# References (this paper â†’ referenced paper)
{"source": paper_id, "target": ref.paper_id, "type": "citation", "weight": 0.5}

# Citations (citing paper â†’ this paper)
{"source": cite.paper_id, "target": paper_id, "type": "citation", "weight": 0.5}
```

These edges appear immediately in the graph as citation-type connections.

### DOI Fallback for Expand ID

When a paper has no `s2_paper_id` (OA-only paper), the expand now falls back to `DOI:{doi}` format which Semantic Scholar also accepts:

```typescript
const expandId = paper.s2_paper_id || (paper.doi ? `DOI:${paper.doi}` : '');
```

Error toasts are shown for both button-click and double-click expand paths.

**Files:** `backend/routers/papers.py`, `frontend/app/explore/page.tsx`

---

## RAG Chat: Richer Context

**Before:** `chat.py` used `build_context()` which only used graph paper IDs for context building.

**After:** Uses `build_context_with_db_search()` which performs pgvector similarity search on the chat query to find the most relevant papers from the entire database â€” not just the currently loaded graph â€” for richer, more accurate RAG responses.

**File:** `backend/routers/chat.py`

---

## Minor Improvements

### Literature Review API
- `generateLitReview` now sends full paper metadata (title, abstract, authors, year, venue, citation_count, fields, tldr, doi, is_open_access) instead of just `paper_ids`
- Fixed LLM params format to send `provider` and `api_key` at top level

### Home Page UX
- Logged-in users now see **"My Account"** link instead of "Sign In" in the footer navigation

**Files:** `frontend/lib/api.ts`, `frontend/app/page.tsx`

---

## Files Changed

| File | Type | Change |
|------|------|--------|
| `backend/integrations/data_fusion.py` | Backend | Sort embedding papers first before truncation |
| `backend/routers/papers.py` | Backend | Embedding-based positioning, citation edges, `include_embedding=True` |
| `backend/routers/chat.py` | Backend | Use `build_context_with_db_search` |
| `frontend/app/explore/page.tsx` | Frontend | DOI fallback for expand ID, error handling |
| `frontend/lib/api.ts` | Frontend | Full paper metadata in lit review, LLM param format fix |
| `frontend/app/page.tsx` | Frontend | "My Account" for logged-in users |

**Commit:** `7b00f44` â€” _fix: embedding coverage + expand positioning + RAG context + UX polish_

---

## í•œêµ­ì–´ ìš”ì•½

### í•µì‹¬ ìˆ˜ì •ì‚¬í•­

**1. ì„ë² ë”© ì»¤ë²„ë¦¬ì§€ ì¹˜ëª…ì  ë²„ê·¸ ìˆ˜ì • (ê°€ì¥ ì¤‘ìš”)**

OA ë…¼ë¬¸ 200ê°œë¥¼ ë¨¼ì € ë³‘í•©í•œ í›„ S2-only ì„ë² ë”© ë…¼ë¬¸ë“¤ì´ 200ê°œ ì œí•œìœ¼ë¡œ ì˜ë ¤ë‚˜ê°€ëŠ” ë¬¸ì œë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤. `merged.sort(key=lambda p: (p.embedding is None,))` ì •ë ¬ ì¶”ê°€ë¡œ ì„ë² ë”© ìˆëŠ” ë…¼ë¬¸ì´ ë¨¼ì € ì„ íƒë©ë‹ˆë‹¤. ê²°ê³¼: 10/200 â†’ 97/200 ë…¼ë¬¸ì— ì„ë² ë”© ì ìš© â†’ ì˜ë¯¸ìˆëŠ” í´ëŸ¬ìŠ¤í„° ìƒì„±.

**2. ì¸ìš© í™•ì¥ ê°œì„ **
- í™•ì¥ëœ ë…¼ë¬¸ì´ SPECTER2 ì„ë² ë”© ê¸°ë°˜ k-NN ìœ„ì¹˜ ì¶”ì •ìœ¼ë¡œ ì˜ë¯¸ì ìœ¼ë¡œ ê°€ê¹Œìš´ ë…¸ë“œ ê·¼ì²˜ì— ë°°ì¹˜ë©ë‹ˆë‹¤
- ì¸ìš© ì—£ì§€ê°€ ì‹¤ì œë¡œ ë°˜í™˜ë©ë‹ˆë‹¤ (ê¸°ì¡´ì—ëŠ” `edges=[]` ì˜€ìŒ)
- DOIë¥¼ fallback IDë¡œ ì§€ì›í•©ë‹ˆë‹¤ (`DOI:{doi}` í¬ë§·)

**3. RAG ì±„íŒ…**: pgvector ìœ ì‚¬ë„ ê²€ìƒ‰ìœ¼ë¡œ ë” í’ë¶€í•œ ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©

**4. ì†Œì†Œí•œ ê°œì„ **: ë¡œê·¸ì¸ ì‚¬ìš©ì í™ˆí˜ì´ì§€ "My Account" í‘œì‹œ, ë¬¸í—Œ ë¦¬ë·° ì „ì²´ ë©”íƒ€ë°ì´í„° ì „ì†¡
