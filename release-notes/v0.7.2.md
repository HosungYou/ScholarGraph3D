# ScholarGraph3D v0.7.2 Release Notes

**Release Date:** 2026-02-20 | **Commits:** e3e38ea â†’ bda33f7

---

## ğŸ“‹ Table of Contents

1. [Critical Bug Fixes: Citation Expand](#-critical-bug-fixes-citation-expand)
2. [S2 API Client Fixes](#-s2-api-client-fixes)
3. [Landing Page: Seed Paper Philosophy](#-landing-page-seed-paper-philosophy)
4. [Technical Limitations & v0.8.0 Targets](#ï¸-technical-limitations--v080-targets)
5. [Files Changed](#-files-changed)
6. [í•œêµ­ì–´ ìš”ì•½](#-í•œêµ­ì–´-ìš”ì•½)
7. [Next: v0.8.0 Roadmap](#next-v080-roadmap)

---

## ğŸ› Critical Bug Fixes: Citation Expand

### Bug 1 â€” `'NoneType' object is not iterable` on expand

**Symptom:** Clicking "Expand" on certain papers returned a 500 error:
```
TypeError: 'NoneType' object is not iterable
```

**Root Cause:** Semantic Scholar API occasionally returns `{"data": null}` for papers with no indexed references or citations. Python's `dict.get(key, default)` only uses the default when the **key is absent** â€” not when the value is explicitly `null`.

```python
# BEFORE (broken): .get("data", []) fails when {"data": null}
for item in data.get("data", []):   # â†’ TypeError: 'NoneType' is not iterable

# AFTER (fixed): (... or []) handles both absent key AND null value
for item in (data.get("data") or []):  # â†’ safe, returns []
```

**Fix applied to:** `backend/integrations/semantic_scholar.py`
- `get_references()`: `data.get("data", [])` â†’ `(data.get("data") or [])`
- `get_citations()`: same fix

**Additional hardening:** HTTP 400/404 responses from S2 (paper not in S2 index, or not found) are now caught and return `[]` instead of re-raising. This prevents non-fatal S2 errors from propagating as 500s.

```python
except httpx.HTTPStatusError as e:
    # 400 = paper not in S2 references index
    # 404 = paper not found â€” both are non-fatal
    if e.response.status_code in (400, 404):
        return []
    raise
```

---

### Bug 2 â€” HTTP 400 from S2 causes entire expand to return 404

**Symptom:** If either `get_references()` or `get_citations()` raised an exception, the entire `expand_paper()` endpoint returned 404 â€” even if only one direction failed.

**Root Cause:** The original expand endpoints wrapped both `get_references()` and `get_citations()` in a single `try/except`. A failure in one direction silently killed both.

```python
# BEFORE: single try/except â€” one failure aborts both directions
try:
    refs = await client.get_references(paper_id)
    cites = await client.get_citations(paper_id)
except Exception:
    raise HTTPException(status_code=404, ...)

# AFTER: independent try/except per direction
try:
    refs = await client.get_references(paper_id, ...)
except Exception as e:
    logger.warning(f"get_references failed for {paper_id}: {e}")

try:
    cites = await client.get_citations(paper_id, ...)
except Exception as e:
    logger.warning(f"get_citations failed for {paper_id}: {e}")
```

**Fix applied to:** `backend/routers/papers.py`
- `expand_paper()`: independent try/except for each direction
- `expand_paper_stable()`: same pattern

**Impact:** Papers with references but no indexed citations (or vice versa) now return partial data instead of a complete failure.

---

### Before / After Comparison

| Scenario | Before v0.7.2 | After v0.7.2 |
|----------|--------------|-------------|
| S2 returns `{"data": null}` | 500 TypeError | `[]` returned (non-fatal) |
| S2 returns HTTP 400 | 404 on entire expand | `[]` for that direction, other succeeds |
| S2 returns HTTP 404 | 404 on entire expand | `[]` returned (non-fatal) |
| Both directions fail | 404 | Empty expand (no error) |
| One direction fails | 404 | Returns available direction |

---

## ğŸ”§ S2 API Client Fixes

### Bug 3 â€” URL Over-Encoding Breaks DOI/ArXiv Lookups (`8757096`)

**Symptom:** DOI lookups like `DOI:10.1038/s41586-021-03819-2` were sent to S2 as `DOI%3A10.1038%2Fs41586-021-03819-2`, returning 404.

**Root Cause:** `urllib.parse.quote_plus()` encodes `:` and `/` characters, but Semantic Scholar's structured IDs (`DOI:`, `ARXIV:`, `CorpusId:`) require these characters to remain unencoded.

```python
# BEFORE (broken): quote_plus encodes : and /
quote_plus("DOI:10.1038/s41586-021-03819-2")
# â†’ "DOI%3A10.1038%2Fs41586-021-03819-2" â†’ S2 404

# AFTER (fixed): quote with safe=':/' preserves structured prefixes
quote("DOI:10.1038/s41586-021-03819-2", safe=':/')
# â†’ "DOI:10.1038/s41586-021-03819-2" â†’ S2 200
```

**Fix:** Changed all `quote_plus(paper_id)` â†’ `quote(paper_id, safe=':/')` in `get_paper()`, `get_references()`, `get_citations()`.

---

### Bug 4 â€” Unsupported Nested Fields Cause HTTP 400 (`b4bf08c`)

**Symptom:** Every call to `get_references()` and `get_citations()` returned HTTP 400:
```
Unrecognized or unsupported fields: [citedPaper.tldr, citedPaper.embedding]
```

**Root Cause:** S2's `/references` and `/citations` endpoints do NOT support `tldr` or `embedding` as nested paper fields. The client was using `PAPER_FIELDS` (which includes both) for all endpoints.

**Fix:** Created `NESTED_PAPER_FIELDS` list excluding `tldr` and `embedding`. The nested endpoints now use this restricted field set.

```python
NESTED_PAPER_FIELDS = [
    "paperId", "title", "abstract", "year", "venue",
    "citationCount", "influentialCitationCount", "referenceCount",
    "openAccessPdf", "externalIds", "authors", "fieldsOfStudy",
    "publicationTypes",
    # NOTE: tldr and embedding NOT supported on nested endpoints
]
```

---

### Bug 5 â€” ArXiv DOIs Not Resolved by S2 (`b4bf08c`)

**Symptom:** ArXiv DOIs like `10.48550/arXiv.1706.03762` returned 404 despite the paper existing in S2.

**Root Cause:** S2 does not index arXiv papers by their DOI (`10.48550/arXiv.*`). They must be looked up using the `ARXIV:` prefix with the arXiv ID.

**Fix:** Added arXiv DOI detection and fallback in `get_paper_by_doi`:

```python
arxiv_match = re.match(r'10\.48550/arXiv\.(.+)', doi_clean)
if arxiv_match:
    arxiv_id = arxiv_match.group(1)
    paper = await s2_client.get_paper(f"ARXIV:{arxiv_id}")
```

---

### Bug 6 â€” Rate Limit Bypass via Per-Request Client Instances (`bda33f7`)

**Symptom:** S2 returned `429 Too Many Requests` even though each client was configured for 1 RPS.

**Root Cause:** Each API request handler created a **new** `SemanticScholarClient` with its own independent rate limiter. Concurrent requests created separate instances that each tracked their own timing â€” collectively exceeding S2's 1 RPS limit.

```
Request A â†’ new Client A (rate limiter A: "I haven't called in 5s, OK!")
Request B â†’ new Client B (rate limiter B: "I haven't called in 5s, OK!")
Request C â†’ new Client C (rate limiter C: "I haven't called in 5s, OK!")
â†’ All 3 call S2 simultaneously â†’ 429
```

**Fix:** Singleton pattern â€” one shared client initialized at startup:

```python
# semantic_scholar.py â€” global singleton
s2_client = SemanticScholarClient()

async def init_s2_client(api_key, requests_per_second):
    global s2_client
    s2_client = SemanticScholarClient(api_key=api_key, ...)

def get_s2_client() -> SemanticScholarClient:
    return s2_client
```

All routers (`papers.py`, `search.py`, `seed_explore.py`) now use `get_s2_client()` instead of constructing new clients. All `.close()` calls removed from routers â€” the singleton lives for the application lifetime.

**Additional:** Redis caching added to `get_references()` and `get_citations()` to reduce S2 API calls.

---

## ğŸŒ Landing Page: Seed Paper Philosophy

v0.7.2 redesigns the landing page around ScholarGraph3D's core value proposition: **Seed Paper topology exploration**, not keyword search.

### Default Mode: DOI (Seed Paper)

The primary search mode is now `doi` (Seed Paper), reflecting the platform's philosophy that a single paper is a richer entry point than a keyword query.

```
Before: default mode = "keyword" â†’ "Search by keywords"
After:  default mode = "doi"     â†’ "Enter a DOI or paper title"
```

### Hero Message

```
Before: "Explore Academic Papers in 3D"
After:  "Navigate the topology of knowledge"
```

### DOI Auto-Detection

A DOI pattern in any search mode automatically routes to seed paper exploration:

```typescript
// DOI pattern detection (any mode)
const DOI_PATTERN = /^10\.\d{4,}\/\S+|https?:\/\/doi\.org\//i;

// handleDOILookup: calls /api/papers/by-doi â†’ routes to /explore/seed?paper_id=
if (DOI_PATTERN.test(inputValue)) {
    handleDOILookup(inputValue);  // auto-route to seed mode
}
```

### Example Seed Papers

Three landmark papers provided as direct DOI examples:

| Paper | DOI | Why included |
|-------|-----|-------------|
| "Attention Is All You Need" | `10.48550/arXiv.1706.03762` | Defines modern NLP |
| AlphaFold (Jumper et al. 2021) | `10.1038/s41586-021-03819-2` | Biology Ã— ML landmark |
| BERT (Devlin et al. 2018) | `10.48550/arXiv.1810.04805` | Pre-training paradigm |

### Philosophy Cards

Three cards explain the 3D topology philosophy to new users:

1. **Citation Topology** â€” Co-citation and bibliographic coupling reveal the knowledge graph
2. **Semantic Clusters** â€” SPECTER2 + UMAP groups papers by meaning, not keywords
3. **Time Depth on Z** â€” Publication year on the Z-axis reveals research evolution

---

## âš ï¸ Technical Limitations & Status

| Limitation | Status | Notes |
|-----------|--------|-------|
| S2 HTTP 400 on expand | âœ… Fixed (v0.7.2) | `NESTED_PAPER_FIELDS` without tldr/embedding; HTTP 400/404 â†’ `[]` |
| S2 rate limit 429 | âœ… Fixed (v0.7.2) | Singleton S2 client + Redis caching for refs/cites |
| URL encoding breaks DOI | âœ… Fixed (v0.7.2) | `quote(safe=':/')` preserves `:` and `/` |
| arXiv DOI not resolved | âœ… Fixed (v0.7.2) | `ARXIV:` prefix fallback |
| Search latency ~72s | âœ… Fixed (v0.8.0) | Citation enrichment detached via `asyncio.create_task()` |
| DOI â†’ paper_id failure | ğŸ”„ Partial | Crossref fallback added; some niche journals still not in S2 |

---

## ğŸ“ Files Changed

| File | Type | Change |
|------|------|--------|
| `backend/integrations/semantic_scholar.py` | Backend | Null-safety `(data.get("data") or [])`, `NESTED_PAPER_FIELDS`, `quote(safe=':/')`, singleton (`get_s2_client()`), Redis caching for refs/cites |
| `backend/routers/papers.py` | Backend | Independent `try/except` per direction; use singleton; ArXiv DOI fallback; remove all `.close()` calls |
| `backend/routers/search.py` | Backend | Use singleton via `get_s2_client()`; remove all `.close()` calls |
| `backend/routers/seed_explore.py` | Backend | Use singleton; remove `try/finally` wrapper; clean up unused imports |
| `backend/main.py` | Backend | `init_s2_client()` on startup, `close_s2_client()` on shutdown (lifespan) |
| `frontend/app/page.tsx` | Frontend | Default mode = `doi`; hero text; DOI auto-detection; example seed papers; philosophy cards |

**Commits:**
- `e3e38ea` â€” fix: expand null-safety + landing page seed-paper redesign
- `8757096` â€” fix(s2): use quote() with safe=':/' instead of quote_plus()
- `b4bf08c` â€” fix(s2): remove unsupported nested fields + arXiv DOI fallback
- `bda33f7` â€” fix(s2): singleton S2 client to prevent rate limit bypass

---

## ğŸ‡°ğŸ‡· í•œêµ­ì–´ ìš”ì•½

### v0.7.2 í•µì‹¬ ë³€ê²½ì‚¬í•­

**1. Citation Expand ì¹˜ëª…ì  ë²„ê·¸ 2ê±´ ìˆ˜ì •**

**ë²„ê·¸ 1: `NoneType` ë°˜ë³µ ì˜¤ë¥˜**

S2 APIê°€ `{"data": null}`ì„ ë°˜í™˜í•  ë•Œ `dict.get(key, default)`ê°€ ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•˜ì§€ ì•Šì•„ TypeError ë°œìƒ.
ìˆ˜ì •: `(data.get("data") or [])` â€” nullê³¼ í‚¤ ë¶€ì¬ ëª¨ë‘ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬.

**ë²„ê·¸ 2: ë‹¨ì¼ ë°©í–¥ ì‹¤íŒ¨ ì‹œ ì „ì²´ expand 404**

`get_references()`ë‚˜ `get_citations()` ì¤‘ í•˜ë‚˜ê°€ ì‹¤íŒ¨í•˜ë©´ ì „ì²´ê°€ 404. ì´ì œ ê° ë°©í–¥ì´ ë…ë¦½ì  `try/except`ë¡œ ì²˜ë¦¬.

**2. S2 API í´ë¼ì´ì–¸íŠ¸ ë²„ê·¸ 4ê±´ ìˆ˜ì •**

**ë²„ê·¸ 3: URL ê³¼ë„ ì¸ì½”ë”©** â€” `quote_plus()`ê°€ `:`ê³¼ `/`ë¥¼ ì¸ì½”ë”©í•˜ì—¬ `DOI%3A10.1038%2F...` â†’ S2 404. ìˆ˜ì •: `quote(safe=':/')` ì‚¬ìš©.

**ë²„ê·¸ 4: ì¤‘ì²© í•„ë“œ ë¯¸ì§€ì›** â€” `/references`, `/citations` ì—”ë“œí¬ì¸íŠ¸ì—ì„œ `tldr`ê³¼ `embedding` í•„ë“œ ë¯¸ì§€ì›ìœ¼ë¡œ HTTP 400 ë°˜í™˜. ìˆ˜ì •: `NESTED_PAPER_FIELDS` ëª©ë¡ ìƒì„± (tldr/embedding ì œì™¸).

**ë²„ê·¸ 5: arXiv DOI ë¯¸ì¸ì‹** â€” S2ëŠ” arXiv ë…¼ë¬¸ì„ DOI(`10.48550/arXiv.*`)ë¡œ ìƒ‰ì¸í•˜ì§€ ì•ŠìŒ. ìˆ˜ì •: `ARXIV:{id}` ì ‘ë‘ì‚¬ í´ë°± ì¶”ê°€.

**ë²„ê·¸ 6: Rate Limit ìš°íšŒ (ì‹±ê¸€í†¤ íŒ¨í„´)** â€” ê° ìš”ì²­ì´ ìƒˆ `SemanticScholarClient` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ë…ë¦½ì ì¸ rate limiterë¥¼ ê°€ì§ â†’ ë™ì‹œ ìš”ì²­ì´ S2ì˜ 1 RPS ì œí•œì„ ì´ˆê³¼. ìˆ˜ì •: í•˜ë‚˜ì˜ ê³µìœ  í´ë¼ì´ì–¸íŠ¸(ì‹±ê¸€í†¤)ë¥¼ ì•± ì‹œì‘ ì‹œ ì´ˆê¸°í™”í•˜ê³  ëª¨ë“  ë¼ìš°í„°ê°€ `get_s2_client()`ë¡œ ê³µìœ . Redis ìºì‹±ë„ ì¶”ê°€.

**3. ëœë”© í˜ì´ì§€ Seed Paper ì² í•™ ë°˜ì˜**

- ê¸°ë³¸ ê²€ìƒ‰ ëª¨ë“œ: `keyword` â†’ `doi` (Seed Paper)
- íˆì–´ë¡œ ë©”ì‹œì§€: "Navigate the topology of knowledge"
- DOI ìë™ ê°ì§€: ì–´ë–¤ ëª¨ë“œì—ì„œë“  DOI íŒ¨í„´ ì…ë ¥ ì‹œ â†’ `/explore/seed`ë¡œ ìë™ ë¼ìš°íŒ…
- ì˜ˆì‹œ ë…¼ë¬¸: Attention Is All You Need, AlphaFold, BERT (ì‹¤ì œ DOI)
- ì² í•™ ì¹´ë“œ: Citation Topology / Semantic Clusters / Time Depth on Z

---

## Next: v0.8.0 Roadmap

### ê¸°ìˆ  í•œê³„ 4ê°€ì§€ ì‹¤ì œ êµ¬í˜„

1. **OpenCitations COCI í†µí•©** â€” DOI ê¸°ë°˜ 20ì–µ+ ì¸ìš© ìŒ, S2 paper_id ì˜ì¡´ë„ ì œê±°
   - ì‹ ê·œ: `backend/integrations/opencitations.py`
   - DB ë§ˆì´ê·¸ë ˆì´ì…˜: `oc_citation_cache` í…Œì´ë¸” (citing_doi, cited_doi, fetched_at)
   - Citation enrichment ìˆœì„œ: OC ìºì‹œ â†’ OC API â†’ S2 í´ë°±

2. **ë¹„ë™ê¸° Citation Enrichment** â€” ê²€ìƒ‰ ì‘ë‹µ ~72s â†’ ~50s
   - `search.py` citation enrichment â†’ `asyncio.create_task()` ë¶„ë¦¬
   - ê²€ìƒ‰ ê²°ê³¼ ì¦‰ì‹œ ë°˜í™˜ (citation edges ì—†ì´)
   - í´ë§ ì—”ë“œí¬ì¸íŠ¸: `GET /api/search/citations?q={hash}`

3. **Redis ìºì‹œ í™œì„±í™”** â€” Upstash URL í”„ë¡œë•ì…˜ ì„¤ì • ì™„ë£Œ, ì¦‰ì‹œ í™œì„±
   - ì‹ ê·œ: `backend/cache.py` (Redis í—¬í¼ í•¨ìˆ˜)
   - ìºì‹œ í‚¤: `emb:{s2_id}` (TTL 30ì¼), `refs:{id}` (TTL 7ì¼), `cites:{id}` (TTL 7ì¼)
   - `semantic_scholar.py`ì˜ `get_references()` / `get_citations()` ì•ì— Redis ì¡°íšŒ ì‚½ì…

4. **Crossref DOI í´ë°±** â€” ê²½ì œÂ·ë²•í•™ ì €ë„ DOI seed ëª¨ë“œ ì§€ì›
   - ì‹ ê·œ: `backend/integrations/crossref.py`
   - `papers.py` `/api/papers/by-doi` í´ë°± ì²´ì¸:
     S2 ì§ì ‘ ì¡°íšŒ â†’ [ì‹¤íŒ¨] â†’ Crossref ë©”íƒ€ë°ì´í„° â†’ title â†’ S2 ê²€ìƒ‰ â†’ ìœ ì‚¬ë„ ë§¤ì¹­
